<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Student Registration</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="min-h-screen bg-gray-100 flex items-center justify-center">

  <div class="bg-white p-8 rounded-xl shadow-lg w-full max-w-md">
    <h2 class="text-2xl font-bold text-center mb-2">
      Student Registration
    </h2>
    <p class="text-sm text-center text-gray-500 mb-6">
      Digital Addiction Risk Assessment System
    </p>

    <form id="registerForm" class="space-y-4">

      <!-- Username -->
      <div>
        <label class="block text-sm font-medium">Username</label>
        <input id="username" type="text"
          class="mt-1 w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
        <p id="usernameError" class="text-red-500 text-sm hidden"></p>
      </div>

      <!-- Email -->
      <div>
        <label class="block text-sm font-medium">Email</label>
        <input id="email" type="email"
          class="mt-1 w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
        <p id="emailError" class="text-red-500 text-sm hidden"></p>
      </div>

      <!-- Password -->
      <div>
        <label class="block text-sm font-medium">Password</label>
        <input id="password" type="password"
          class="mt-1 w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
        <p id="passwordError" class="text-red-500 text-sm hidden"></p>
      </div>

      <!-- College -->
      <div>
        <label class="block text-sm font-medium">College / Institution</label>
        <input id="college" type="text"
          class="mt-1 w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
        <p id="collegeError" class="text-red-500 text-sm hidden"></p>
      </div>

      <!-- Submit -->
      <button
        type="submit"
        class="w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 transition">
        Register
      </button>

      <p id="serverMessage" class="text-center text-sm mt-2 hidden"></p>

      <p class="text-sm text-center text-gray-500 mt-4">
        Already registered?
        <a href="login.html" class="text-blue-600 hover:underline">
          Login here
        </a>
      </p>
    <hr>
    <p class="text-center text-sm text-gray-500 mt-4">
        Â© <span id="year"></span> DARAS
    </p>

    <script>
        document.getElementById("year").textContent = new Date().getFullYear();
    </script>
    </form>
  </div>

<script>
const form = document.getElementById("registerForm");

const username = document.getElementById("username");
const email = document.getElementById("email");
const password = document.getElementById("password");
const college = document.getElementById("college");

const errors = {
  usernameError: document.getElementById("usernameError"),
  emailError: document.getElementById("emailError"),
  passwordError: document.getElementById("passwordError"),
  collegeError: document.getElementById("collegeError"),
};

const serverMessage = document.getElementById("serverMessage");

form.addEventListener("submit", async (e) => {
  e.preventDefault();

  let valid = true;
  serverMessage.classList.add("hidden");

  // Reset errors
  Object.values(errors).forEach(el => el.classList.add("hidden"));

  if (!username.value) {
    errors.usernameError.textContent = "Username is required";
    errors.usernameError.classList.remove("hidden");
    valid = false;
  }

  if (!email.value || !email.value.includes("@")) {
    errors.emailError.textContent = "Valid email is required";
    errors.emailError.classList.remove("hidden");
    valid = false;
  }

  if (!password.value || password.value.length < 6) {
    errors.passwordError.textContent = "Password must be at least 6 characters";
    errors.passwordError.classList.remove("hidden");
    valid = false;
  }

  if (!college.value) {
    errors.collegeError.textContent = "College name is required";
    errors.collegeError.classList.remove("hidden");
    valid = false;
  }

  if (!valid) return;

  try {
    const response = await fetch("http://localhost:8000/api/student/register/", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        username: username.value,
        email: email.value,
        password: password.value,
        college: college.value,
      }),
    });

    const data = await response.json();

    serverMessage.textContent = data.message;
    serverMessage.classList.remove("hidden");

    if (response.ok) {
      serverMessage.classList.add("text-green-600");
      form.reset();
    } else {
      serverMessage.classList.add("text-red-600");
    }

  } catch {
    serverMessage.textContent = "Server not reachable";
    serverMessage.classList.remove("hidden");
    serverMessage.classList.add("text-red-600");
  }
});
</script>

</body>
</html>
